# Order Microservice APIs

## Order Structure

Each order is with 6 attributes: `orderid`, `email`, `order_date`, `total`, `shipping_info`, `billing_info`

`orderid`: automatically generated id for order
`order_date`: automatically generated by database
`total`: automatically calculated by subtotals of items in the orderline
`shipping_info`: shipping address for the order
`billing_info`: card number used in payment

Example:

```json
{
    "orderinfo": {
        "billing_info": "credit ending in 1234",
        "email": "ys3609@columbia.edu",
        "order_date": "Fri, 09 Dec 2022 00:41:28 GMT",
        "orderid": 1,
        "shipping_info": "212w",
        "total": 112
    },
    "orderline": {
        "metadata": {
            "result_set": {
                "count": 2,
                "page": 1,
                "pagesize": 2,
                "total": 2,
                "total_page": 1
            }
        },
        "results": [
            {
                "amount": 1,
                "itemid": 49,
                "lineid": 1,
                "links": [
                    {
                        "href": "/order/1",
                        "rel": "order"
                    },
                    {
                        "href": "/order/1/orderline/1",
                        "rel": "self"
                    }
                ],
                "orderid": 1,
                "price": 99,
                "subtotal": 99
            },
            {
                "amount": 2,
                "itemid": 23,
                "lineid": 2,
                "links": [
                    {
                        "href": "/order/1",
                        "rel": "order"
                    },
                    {
                        "href": "/order/1/orderline/2",
                        "rel": "self"
                    }
                ],
                "orderid": 1,
                "price": 77,
                "subtotal": 154
            }
        ]
    }
}
```

## Orderline Structure (item in the order's orderline)

Each item is with 6 attributes: `orderid`, `lineid`, `itemid`, `price`, `amount`, `subtotal`

`orderid`: id of the order the orderline belongs to
`lineid`: the internal id for the item in the orderline, suppose 3 items in the orderline, the `lineid` is from 1 to 3
`itemid`: the id for an item in the Catalog, managed by the Catalog Microservice
`subtotal`: `amount` * `price`, automatically calculated by the database

Example:

The NO.2 item (`lineid`=2) in orderline with `orderid`=1.

```json
{
    "amount": 2,
    "itemid": 23,
    "lineid": 2,
    "links": [
        {
            "href": "/order/1",
            "rel": "order"
        },
        {
            "href": "/order/1/orderline/2",
            "rel": "self"
        }
    ],
    "orderid": 1,
    "price": 77,
    "subtotal": 154
}
```

## GET

### GET /order/\<int: orderid\>

```http
GET /order/<int:orderid>
```

GET an order by its `orderid`, the return includes attributes for this order and also the orderline for it. Optional query string: `page`, `pagesize` (default=10).

In pagination section `metadata/result_set`:
`count`: number of items in the orderline in this page
`page`: current page number
`pagesize`: max number of items in a page
`total`: total number of items (in all pages)
`total_page`: total pages available

Example:

```http
GET /order/1?pagesize=5&page=1
```

```json
{
    "orderinfo": {
        "billing_info": "credit ending in 1234",
        "email": "ys3609@columbia.edu",
        "order_date": "Fri, 09 Dec 2022 00:41:28 GMT",
        "orderid": 1,
        "shipping_info": "212w",
        "total": 112
    },
    "orderline": {
        "metadata": {
            "result_set": {
                "count": 2,
                "page": 1,
                "pagesize": 5,
                "total": 2,
                "total_page": 1
            }
        },
        "results": [
            {
                "amount": 1,
                "itemid": 49,
                "lineid": 1,
                "links": [
                    {
                        "href": "/order/1",
                        "rel": "order"
                    },
                    {
                        "href": "/order/1/orderline/1",
                        "rel": "self"
                    }
                ],
                "orderid": 1,
                "price": 99,
                "subtotal": 99
            },
            {
                "amount": 2,
                "itemid": 23,
                "lineid": 2,
                "links": [
                    {
                        "href": "/order/1",
                        "rel": "order"
                    },
                    {
                        "href": "/order/1/orderline/2",
                        "rel": "self"
                    }
                ],
                "orderid": 1,
                "price": 77,
                "subtotal": 154
            }
        ]
    }
}
```

Status code: 200

---

```http
GET /order/1?pagesize=5&page=2 (empty page)
```

```json
{
    "orderinfo": {
        "billing_info": "credit ending in 1234",
        "email": "ys3609@columbia.edu",
        "order_date": "Fri, 09 Dec 2022 00:41:28 GMT",
        "orderid": 1,
        "shipping_info": "212w",
        "total": 112
    },
    "orderline": {
        "metadata": {
            "result_set": {
                "count": 0,
                "page": 2,
                "pagesize": 5,
                "total": 2,
                "total_page": 1
            }
        },
        "results": []
    }
}
```

Status code: 200

----

```http
GET /order/2?pagesize=5&page=2 (The order with orderid=2 doesn't exist)
```

```
{
    "message": "order not found"
}
```

Status code: 404

### GET /order/\<int: orderid\>/orderline/\<int: lineid\>

```http
GET /order/<int:orderid>/orderline/<int:lineid>
```

GET an item in an orderline by the `orderid` and `lineid`

Example:

```http
GET /order/1/orderline/2
```

```json
{
    "amount": 2,
    "itemid": 23,
    "lineid": 2,
    "links": [
        {
            "href": "/order/1",
            "rel": "order"
        },
        {
            "href": "/order/1/orderline/2",
            "rel": "self"
        }
    ],
    "orderid": 1,
    "price": 77,
    "subtotal": 154
}
```

Status code: 200

---

```http
GET /order/1/orderline/3 (The item with lineid=3 doesn't exist in this order)
```

```json
{
    "message": "order line not found"
}
```

Status code: 404

---

```http
GET /order/2/orderline/1 (The order with orderid=2 doesn't exist)
```

```json
{
    "message": "order not found"
}
```

Status code: 404

### GET /order/\<string: email\>

```http
GET /order/<string:email>
```

GET all the orders with the `email`. The return only includes attributes for the orders with the email. The Optional query string: `page`, `pagesize` (default=10).

Example:

```http
GET /order/ww2569@columbia.edu?pagesize=2&page=1 (2 orders are found with the email)
```

```json
{
    "metadata": {
        "result_set": {
            "count": 2,
            "page": 1,
            "pagesize": 2,
            "total": 2,
            "total_page": 1
        }
    },
    "results": [
        {
            "billing_info": "credit ending in 1998",
            "email": "ww2569@columbia.edu",
            "links": [
                {
                    "href": "/order/3",
                    "rel": "order"
                },
                {
                    "href": "/order/ww2569%40columbia.edu",
                    "rel": "self"
                }
            ],
            "order_date": "Fri, 09 Dec 2022 00:43:08 GMT",
            "orderid": 3,
            "shipping_info": "119th street",
            "total": 0
        },
        {
            "billing_info": "credit ending in 1998",
            "email": "ww2569@columbia.edu",
            "links": [
                {
                    "href": "/order/4",
                    "rel": "order"
                },
                {
                    "href": "/order/ww2569%40columbia.edu",
                    "rel": "self"
                }
            ],
            "order_date": "Fri, 09 Dec 2022 00:57:01 GMT",
            "orderid": 4,
            "shipping_info": "119th street",
            "total": 0
        }
    ]
}
```

Status code: 200

---

```http
GET /order/ww2569@columbia.edu?pagesize=2&page=2 (empty page)
```

```json
{
    "metadata": {
        "result_set": {
            "count": 0,
            "page": 2,
            "pagesize": 2,
            "total": 2,
            "total_page": 1
        }
    },
    "results": []
}
```

Status code: 200

----

```http
GET /order/ww1234@columbia.edu (Order with email=ww1234... doesn't exist)
```

```json
{
    "message": "order not found"
}
```

Status code: 404

## POST

### POST /order

```http
POST /order
```

POST an order, with all 3 necessary attributes: `email`, `shipping_info`, `billing_info`

Example:

Request body:

```json
{
        "billing_info": "credit ending in 8888",
        "email": "testemail@columbia.edu",
        "shipping_info": "1080"
}
```

Response body (All 6 attributes of an order are returned, along with an empty orderline section):

```json
{
    "orderinfo": {
        "billing_info": "credit ending in 8888",
        "email": "testemail@columbia.edu",
        "order_date": "Mon, 12 Dec 2022 22:48:47 GMT",
        "orderid": 3,
        "shipping_info": "1234",
        "total": 0
    },
    "orderline": []
}
```

Status code: 200 (POST orders with same request body is allowed, just different order with same customer info)

### POST /order/<int: orderid>/orderline

```http
POST /order/<int:orderid>/orderline
```

POST an item into an orderline specified by its `orderid`. **(TODO: merge same item together)** (TODO: Update the `total` in the order)

Example:

```http
POST /order/2/orderline
```

Request body:

```json
{
    "itemid": 30,
    "price": 5,
    "amount": 6
}
```

Response body:

```
{
    "amount": 6,
    "itemid": 30,
    "lineid": 3,
    "orderid": 2,
    "price": 5,
    "subtotal": 30
}
```

Status code: 200

---

```http
POST /order/5/orderline (The order with orderid=5 doesn't exist)
```

Request body: ...

Response body:

```json
{
    "message": "order not found"
}
```

Status code: 404

## DELETE

### DELETE /order/<int: orderid>

```http
DELETE /order/<int:orderid>
```

DELETE an order by its `orderid`

Example:

```http
DELETE /order/3
```

```json
{
    "message": "order deletion successful"
}
```

Status code: 200

---

```http
DELETE /order/3 (This order doesn't exist)
```

```json
{
    "message": "order not found"
}
```

Status code: 404

### DELETE /order/<int: orderid>/orderline/<int: lineid>

DELETE an item in the orderline by the `orderid` and internal `lineid`

```http
DELETE /order/1/orderline/2
```

```json
{
    "message": "orderline deletion successful"
}
```

Status code: 200

---

```http
DELETE /order/1/orderline/2 (The item in the orderline doesn't exist)
```

```json
{
    "message": "orderline not found"
}
```

Status code: 404



# **Continue here..**

## PUT

### PUT /items/\<int: item_id\>

```http
PUT /items/<int:item_id>
```

PUT/UPDATE an item by its `id`. In the request body, specify the new values of attributes among `name`, `description`, `item_price`, `image_url`, `stock`

Example:

```http
PUT /items/5
```

Request body (specify the new values need to be updated):

```json
{
    "stock": 4,
    "item_price":30
}
```

Response body (return all the attributes of the updated item):

```json
{
    "description": "Eggs pack, 12 count",
    "id": 5,
    "image_url": null,
    "item_price": 30.0,
    "name": "Eggs Brown Large Grade A, 12 Count",
    "stock": 4
}
```

Status code: 200

---

Request body (using the same body to update the item):

```json
{
    "stock": 4,
    "item_price":30
}
```

Response body:

```json
{
    "message": "same update"
}
```

Status code: 400

---

```http
PUT /items/25 (this item doesn't exist)
```

Request body: ...

Response body:

```json
{
    "message": "item not found"
}
```

Status code: 404
